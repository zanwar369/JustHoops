<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Just Hoops Stats Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fc; }
        .data-card { transition: all 0.3s ease; }
        .data-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); }
        .tab-button.active { border-bottom: 3px solid #4f46e5; color: #4f46e5; font-weight: 700; }
        .sortable-header { cursor: pointer; user-select: none; }
        .stat-table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .stat-table { min-width: 1000px; } /* Ensures readability on all columns */
    </style>
</head>
<body>
    <div id="app" class="min-h-screen">
        <header class="bg-white shadow-md">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                <h1 class="text-3xl font-extrabold text-gray-900">
                    <span class="text-indigo-600">Just Hoops</span> Stats
                </h1>
                <div id="dataStatus" class="text-sm font-medium text-gray-500">Loading Data...</div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- Global Controls -->
            <div class="mb-6 bg-white p-4 rounded-lg shadow-md">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center gap-2">
                        <label for="seasonFilter" class="text-gray-700 font-semibold">Season:</label>
                        <select id="seasonFilter" class="border rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                    <div class="flex items-center gap-2">
                        <label for="divisionFilter" class="text-gray-700 font-semibold">Division:</label>
                        <select id="divisionFilter" class="border rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500" onchange="filterData()">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div id="mainView">
                <!-- Tabs -->
                <nav class="flex space-x-4 border-b border-gray-200 mb-6">
                    <button id="standingsTab" class="tab-button active px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" onclick="setTabView('standings')">Standings & Leaders</button>
                    <button id="teamTab" class="tab-button px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hidden" onclick="setTabView('team')">Team Stats</button>
                </nav>

                <!-- Standings View -->
                <div id="standingsView" class="space-y-8">
                    <!-- Summary Cards -->
                    <div id="summaryCards" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div id="totalTeamsCard" class="data-card bg-indigo-500 text-white p-6 rounded-xl shadow-lg">
                            <p class="text-sm font-medium opacity-80">Total Teams</p>
                            <p id="totalTeams" class="text-3xl font-extrabold mt-1">0</p>
                        </div>
                    </div>

                    <!-- Standings Table -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Division Standings</h2>
                        <div class="stat-table-container">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Team</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">W</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">L</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Win %</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PTS</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">OPP PTS</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Diff</th>
                                    </tr>
                                </thead>
                                <tbody id="standingsTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Standings rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                        <div id="standingsMessage" class="text-center py-4 text-gray-500 hidden">No standings data available for this selection.</div>
                    </div>

                    <!-- League Leaders -->
                    <div id="leadersSection" class="bg-white p-6 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Top 5 Division Leaders</h2>
                        <div id="leadersGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6">
                            <!-- Leader cards will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Team View -->
                <div id="teamView" class="hidden space-y-8">
                    <button class="text-indigo-600 hover:text-indigo-800 font-semibold flex items-center mb-4" onclick="setTabView('standings')">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                        Back to Standings
                    </button>
                    
                    <h2 id="teamNameHeader" class="text-3xl font-extrabold text-gray-900 mb-4"></h2>
                    
                    <!-- Team Filtering and View Toggle -->
                    <div class="flex flex-wrap items-center gap-4 bg-gray-100 p-4 rounded-lg shadow-inner">
                        <div class="flex items-center gap-2">
                            <label for="teamFilter" class="text-gray-700 font-semibold">Team:</label>
                            <select id="teamFilter" class="border rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500" onchange="loadTeamStats()">
                                <!-- Team options populated by JS (cascading) -->
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="weekFilter" class="text-gray-700 font-semibold">Data View:</label>
                            <select id="weekFilter" class="border rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500" onchange="loadTeamStats()">
                                <option value="avg">Player Averages (Cumulative)</option>
                                <!-- Weekly options populated by JS -->
                            </select>
                        </div>
                    </div>

                    <!-- Team Stats Table -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 id="statsTitle" class="text-xl font-bold text-gray-800 mb-4">Player Averages</h3>
                        <div class="stat-table-container">
                            <table class="min-w-full divide-y divide-gray-200 stat-table">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Player</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">GP</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PTS</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">REB</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">AST</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">BLK</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">STL</th>
                                        
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">FG%</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">2PM</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">2PA</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">2P%</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">3PM</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">3PA</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">3P%</th>

                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">FTM</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">FTA</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">FT%</th>

                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">TO</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Foul</th>

                                    </tr>
                                </thead>
                                <tbody id="teamStatsTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Player rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                        <div id="teamMessage" class="text-center py-4 text-gray-500 hidden">No player data available for this team and week.</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let LEAGUE_DATA = {};
        let currentView = 'standings';
        let currentSeason = 'Winter 2025';
        let currentDivision = 'D2';
        let currentTeam = '';
        let sortColumn = 'Standings_Rank'; 
        let sortDirection = 'asc';

        // --- CORE DATA FETCHING ---
        async function init() {
            try {
                // Fetch the JSON file from the repository root
                const response = await fetch('league_data.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                LEAGUE_DATA = data;

                if (!LEAGUE_DATA || !LEAGUE_DATA[currentSeason]) {
                    document.getElementById('dataStatus').textContent = 'ERROR: Season data not found.';
                    return;
                }

                // Identify all divisions and initialize filters
                const allDivisions = [...new Set(LEAGUE_DATA[currentSeason].finalStandings.map(t => t.division))];
                // CRITICAL FIX: Filter out blank/null divisions before rendering
                const cleanDivisions = allDivisions.filter(d => d && d.trim() !== '');

                // Set default division to D2 if it exists, otherwise use the first clean division
                if (cleanDivisions.includes('D2')) {
                    currentDivision = 'D2';
                } else if (cleanDivisions.length > 0) {
                    currentDivision = cleanDivisions[0];
                }

                populateFilters(cleanDivisions);
                
                document.getElementById('dataStatus').textContent = 'Data Loaded Successfully';
                renderView();
                
            } catch (error) {
                document.getElementById('dataStatus').textContent = 'ERROR: See Console';
                console.error("Initialization Error:", error);
            }
        }

        // --- UTILITY FUNCTIONS ---

        // Function to safely calculate percentage and format it
        function calculatePercentage(numerator, denominator) {
            if (denominator === 0 || isNaN(denominator)) return '0.0%';
            return (numerator / denominator * 100).toFixed(1) + '%';
        }

        // Function to safely get a numeric value, defaulting to 0
        function getNum(value) {
            const num = parseFloat(value);
            return isNaN(num) ? 0 : num;
        }
        
        // --- FILTERING AND NAVIGATION ---

        function populateFilters(divisions) {
            const seasonSelect = document.getElementById('seasonFilter');
            seasonSelect.innerHTML = `<option value="${currentSeason}">${currentSeason}</option>`; // Only one season supported right now

            const divisionSelect = document.getElementById('divisionFilter');
            divisionSelect.innerHTML = '';
            
            divisions.forEach(div => {
                const option = document.createElement('option');
                option.value = div;
                option.textContent = div;
                divisionSelect.appendChild(option);
            });
            divisionSelect.value = currentDivision;
        }

        function filterData() {
            currentSeason = document.getElementById('seasonFilter').value;
            currentDivision = document.getElementById('divisionFilter').value;
            renderView();
        }

        function setTabView(view, teamName = null) {
            currentView = view;
            document.getElementById('standingsTab').classList.remove('active');
            document.getElementById('teamTab').classList.remove('active');
            document.getElementById('standingsView').classList.add('hidden');
            document.getElementById('teamView').classList.add('hidden');
            
            if (view === 'standings') {
                document.getElementById('standingsTab').classList.add('active');
                document.getElementById('standingsView').classList.remove('hidden');
                document.getElementById('teamTab').classList.add('hidden');
            } else if (view === 'team') {
                document.getElementById('teamTab').classList.remove('hidden');
                document.getElementById('teamTab').classList.add('active');
                document.getElementById('teamView').classList.remove('hidden');
                
                if (teamName) {
                    currentTeam = teamName;
                    
                    // CRITICAL: Cascade team filter based on selected division
                    const filteredTeams = LEAGUE_DATA[currentSeason].finalStandings
                        .filter(s => s.division === currentDivision && s.team && s.team.trim() !== ''); // Filter out null/blank teams
                    
                    const teamSelect = document.getElementById('teamFilter');
                    teamSelect.innerHTML = filteredTeams.map(t => `<option value="${t.team}">${t.team}</option>`).join('');
                    teamSelect.value = currentTeam;

                    loadTeamStats();
                }
            }
            window.scrollTo(0, 0); // Scroll to top on view change
        }

        function renderView() {
            if (currentView === 'standings') {
                renderStandings();
                renderLeaders();
            } else if (currentView === 'team') {
                loadTeamStats();
            }
        }

        // --- STANDINGS VIEW RENDERING ---

        function renderStandings() {
            const standingsData = LEAGUE_DATA[currentSeason]?.finalStandings || [];
            
            // 1. Filter and Clean Data
            const filteredStandings = standingsData
                .filter(s => s.division === currentDivision)
                .filter(s => s.team && s.team.trim() !== ''); // REMOVE BLANK TEAMS
            
            // 2. Sort by Rank (assuming rank is provided)
            filteredStandings.sort((a, b) => getNum(a.Standings_Rank) - getNum(b.Standings_Rank));

            // 3. Render Table
            const tbody = document.getElementById('standingsTableBody');
            tbody.innerHTML = '';
            
            if (filteredStandings.length === 0) {
                document.getElementById('standingsMessage').classList.remove('hidden');
                document.getElementById('totalTeams').textContent = 0;
                return;
            }
            document.getElementById('standingsMessage').classList.add('hidden');

            filteredStandings.forEach(team => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50 cursor-pointer';
                tr.onclick = () => setTabView('team', team.team);
                
                tr.innerHTML = `
                    <td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${team.Standings_Rank || '-'}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-indigo-600">${team.team}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${team.Wins || 0}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${team.Losses || 0}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${calculatePercentage(team.Wins, team.Wins + team.Losses)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${team.Points || 0}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${team.Opponent_Points || 0}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${team.Point_Diff > 0 ? '+' : ''}${team.Point_Diff || 0}</td>
                `;
                tbody.appendChild(tr);
            });

            // 4. Update Summary Cards
            document.getElementById('totalTeams').textContent = filteredStandings.length;
        }

        // --- LEADERS RENDERING ---
        function calculatePlayerAverages(playerLogs) {
            const playerStats = {};

            playerLogs.forEach(log => {
                const playerName = log.name;
                
                if (!playerStats[playerName]) {
                    playerStats[playerName] = {
                        name: playerName,
                        team: log.team,
                        division: log.division,
                        number: log.jersey,
                        games: 0,
                        totalpoints: 0, rebounds: 0, assists: 0, blocks: 0, steals: 0, turnovers: 0, fouls: 0,
                        ftm: 0, fta: 0, two_pm: 0, two_pa: 0, three_pm: 0, three_pa: 0,
                    };
                }

                const stats = playerStats[playerName];
                stats.games += 1;
                stats.totalpoints += getNum(log.totalpoints);
                stats.rebounds += getNum(log.rebounds);
                stats.assists += getNum(log.assists);
                stats.blocks += getNum(log.blocks);
                stats.steals += getNum(log.steals);
                stats.turnovers += getNum(log.turnovers);
                stats.fouls += getNum(log.fouls);
                stats.ftm += getNum(log.ftm);
                stats.fta += getNum(log.fta);
                stats.two_pm += getNum(log['2pm']);
                stats.two_pa += getNum(log['2pa']);
                stats.three_pm += getNum(log['3pm']);
                stats.three_pa += getNum(log['3pa']);
            });

            // Calculate Averages and Percentages
            return Object.values(playerStats).map(stats => {
                const games = stats.games;
                return {
                    ...stats,
                    ppg: (stats.totalpoints / games).toFixed(1),
                    rpg: (stats.rebounds / games).toFixed(1),
                    apg: (stats.assists / games).toFixed(1),
                    bpg: (stats.blocks / games).toFixed(1),
                    spg: (stats.steals / games).toFixed(1),

                    // Shooting Totals for %
                    fgm: stats.two_pm + stats.three_pm,
                    fga: stats.two_pa + stats.three_pa,

                    // Percentages
                    fg_percent: calculatePercentage(stats.two_pm + stats.three_pm, stats.two_pa + stats.three_pa),
                    two_p_percent: calculatePercentage(stats.two_pm, stats.two_pa),
                    three_p_percent: calculatePercentage(stats.three_pm, stats.three_pa),
                    ft_percent: calculatePercentage(stats.ftm, stats.fta),
                };
            });
        }

        function renderLeaders() {
            const playerLogs = LEAGUE_DATA[currentSeason]?.playerGameLogs || [];
            
            // Filter logs by the current division
            const filteredLogs = playerLogs.filter(log => log.division === currentDivision);

            // Calculate cumulative averages for all players in the filtered division
            const allPlayerAverages = calculatePlayerAverages(filteredLogs);

            const leaderCategories = [
                { key: 'totalpoints', label: 'Points', formatter: v => v.toFixed(0), sortKey: 'totalpoints' },
                { key: 'rebounds', label: 'Rebounds', formatter: v => v.toFixed(0), sortKey: 'rebounds' },
                { key: 'assists', label: 'Assists', formatter: v => v.toFixed(0), sortKey: 'assists' },
                { key: 'steals', label: 'Steals', formatter: v => v.toFixed(0), sortKey: 'steals' },
                { key: 'blocks', label: 'Blocks', formatter: v => v.toFixed(0), sortKey: 'blocks' },
                { key: 'fg_percent', label: 'FG%', formatter: v => v, sortKey: 'fga' }, // Use FGA as secondary sort for high %
            ];

            const leadersGrid = document.getElementById('leadersGrid');
            leadersGrid.innerHTML = '';

            leaderCategories.forEach(category => {
                let leaders;

                if (category.key === 'fg_percent') {
                    // For percentages, sort by FG% descending, then FGA descending (to prioritize volume)
                    leaders = [...allPlayerAverages]
                        .filter(p => p.fga >= 5) // Minimum 5 attempts to qualify for % leaders
                        .sort((a, b) => {
                            const percentA = getNum(a[category.key].replace('%', '')) / 100;
                            const percentB = getNum(b[category.key].replace('%', '')) / 100;
                            if (percentB !== percentA) return percentB - percentA;
                            return b.fga - a.fga; // Tiebreaker by volume
                        })
                        .slice(0, 5);
                } else {
                    // For totals, sort by the stat key descending
                    leaders = [...allPlayerAverages]
                        .sort((a, b) => getNum(b[category.key]) - getNum(a[category.key]))
                        .slice(0, 5);
                }


                const card = document.createElement('div');
                card.className = 'bg-gray-50 p-4 rounded-lg border border-gray-200 shadow-sm';
                
                const listItems = leaders.map((player, index) => `
                    <li class="flex justify-between items-center text-sm ${index < 3 ? 'font-semibold' : ''}">
                        <span class="text-gray-700">${index + 1}. ${player.name} (${player.team})</span>
                        <span class="text-indigo-600">${category.formatter(player[category.key])}</span>
                    </li>
                `).join('');

                card.innerHTML = `
                    <h4 class="text-md font-extrabold text-gray-900 mb-2 border-b pb-1">${category.label} Leaders</h4>
                    <ul class="space-y-1">
                        ${listItems}
                    </ul>
                `;
                leadersGrid.appendChild(card);
            });
        }

        // --- TEAM VIEW RENDERING ---

        function loadTeamStats() {
            const teamName = document.getElementById('teamFilter').value;
            const weekFilter = document.getElementById('weekFilter').value;

            document.getElementById('teamNameHeader').textContent = teamName;
            document.getElementById('statsTitle').textContent = (weekFilter === 'avg' ? 'Player Averages (Cumulative)' : `Game Log - Week ${weekFilter}`);

            const playerLogs = LEAGUE_DATA[currentSeason]?.playerGameLogs || [];
            
            // 1. Determine Max Week and Populate Week Filter
            const maxWeek = playerLogs.reduce((max, log) => Math.max(max, getNum(log.week)), 0);
            const weekSelect = document.getElementById('weekFilter');
            if (weekSelect.options.length <= 1) { // Populate only once
                for (let i = 1; i <= maxWeek; i++) {
                    weekSelect.innerHTML += `<option value="${i}">Week ${i}</option>`;
                }
                weekSelect.value = weekFilter; // Restore selection
            }

            let dataToDisplay = [];
            
            if (weekFilter === 'avg') {
                // Get all logs for the current team and calculate averages
                const teamLogs = playerLogs.filter(log => log.team === teamName);
                if (teamLogs.length > 0) {
                    dataToDisplay = calculatePlayerAverages(teamLogs);
                }
            } else {
                // Get logs for the specific week
                dataToDisplay = playerLogs.filter(log => log.team === teamName && getNum(log.week) === getNum(weekFilter));
            }

            renderTeamStatsTable(dataToDisplay, weekFilter);
        }

        function renderTeamStatsTable(playerData, viewType) {
            const tbody = document.getElementById('teamStatsTableBody');
            tbody.innerHTML = '';
            
            if (playerData.length === 0) {
                document.getElementById('teamMessage').classList.remove('hidden');
                return;
            }
            document.getElementById('teamMessage').classList.add('hidden');

            const isAvg = viewType === 'avg';

            playerData.forEach(player => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';

                // Helper to format a value, depending on whether it's an average or a total/log value
                const formatValue = (key, rawValue) => {
                    if (key.includes('_percent') || key === 'fg_percent') {
                        // Percentages are pre-formatted strings in the average object
                        return isAvg ? rawValue : calculatePercentage(player[key.replace('_percent', 'm')], player[key.replace('_percent', 'a')]);
                    }
                    // Averages are calculated to 1 decimal, totals are integers
                    return isAvg ? parseFloat(rawValue).toFixed(1) : getNum(rawValue);
                };

                tr.innerHTML = `
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${player.number || '-'}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${player.name}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${isAvg ? player.games : (viewType)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm font-bold text-indigo-600">${formatValue('totalpoints', player.totalpoints)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('rebounds', player.rebounds)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('assists', player.assists)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('blocks', player.blocks)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('steals', player.steals)}</td>
                    
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('fg_percent', player.fg_percent)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('two_pm', player.two_pm)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('two_pa', player.two_pa)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('two_p_percent', player.two_p_percent)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('three_pm', player.three_pm)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('three_pa', player.three_pa)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('three_p_percent', player.three_p_percent)}</td>
                    
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('ftm', player.ftm)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('fta', player.fta)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('ft_percent', player.ft_percent)}</td>

                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('turnovers', player.turnovers)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${formatValue('fouls', player.fouls)}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // --- INITIALIZATION ---
        window.onload = init;
    </script>
</body>
</html>
