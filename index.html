<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Just Hoops Stats Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fc; }
        .data-card { transition: all 0.3s ease; }
        .data-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); }
        .tab-button.active { border-bottom: 3px solid #4f46e5; color: #4f46e5; font-weight: 700; }
        .sortable-header { cursor: pointer; user-select: none; }
        .stat-table th, .stat-table td { padding-left: 0.5rem; padding-right: 0.5rem; }
        .stat-table th:first-child, .stat-table td:first-child { padding-left: 1.5rem; }
        .stat-table th:last-child, .stat-table td:last-child { padding-right: 1.5rem; }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen">
        <header class="bg-white shadow-md">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row justify-between items-center">
                <h1 class="text-3xl font-extrabold text-indigo-700">üèÄ Just Hoops Stats</h1>
                <span id="dataStatus" class="text-sm font-medium text-gray-500 mt-2 sm:mt-0">Loading Data...</span>
            </div>
        </header>

        <main class="max-w-7xl mx-auto mt-8 px-4 sm:px-6 lg:px-8">
            <!-- Global Controls -->
            <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                <div class="flex flex-col sm:flex-row gap-4 justify-start items-start sm:items-center">
                    
                    <div class="w-full sm:w-auto">
                        <label for="season-select" class="block text-sm font-medium text-gray-700">Season</label>
                        <select id="season-select" onchange="filterData()" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                            <!-- Options populated by JS -->
                        </select>
                    </div>

                    <div class="w-full sm:w-auto">
                        <label for="division-select" class="block text-sm font-medium text-gray-700">Division</label>
                        <select id="division-select" onchange="filterData()" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                             <!-- Options populated by JS, defaults to D2 -->
                        </select>
                    </div>

                    <!-- Search Input (Only visible on Standings View) -->
                    <div id="standings-search-container" class="flex-grow relative w-full sm:w-auto hidden">
                        <label for="searchInput" class="block text-sm font-medium text-gray-700">Search Team or Player</label>
                        <input
                            type="text"
                            id="searchInput"
                            placeholder="Search..."
                            oninput="filterData()"
                            class="mt-1 w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                        />
                        <svg class="absolute left-3 top-8 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                </div>
            </div>

            <!-- Main Content Display -->
            <div id="main-content">
                <!-- Tabs -->
                <nav class="flex space-x-4 border-b border-gray-300 mb-6">
                    <button class="tab-button active pb-3 px-2 text-lg" onclick="setTabView('standings')">Standings</button>
                    <button id="team-stats-tab" class="tab-button pb-3 px-2 text-lg disabled:text-gray-400 disabled:cursor-not-allowed" onclick="setTabView('team')" disabled>Team Stats</button>
                </nav>

                <!-- 1. Standings View -->
                <div id="standings-view" class="active-view">
                    <!-- Summary Card -->
                    <div class="grid grid-cols-1 gap-6 mb-8">
                        <div class="data-card bg-white p-6 rounded-xl shadow-xl border-b-4 border-indigo-500">
                            <p class="text-sm font-medium text-gray-500 uppercase">Total Teams Tracked</p>
                            <p id="total-teams-count" class="mt-1 text-4xl font-extrabold text-gray-900">-</p>
                        </div>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Current Standings</h2>
                    <div class="bg-white rounded-xl shadow-2xl overflow-x-auto mb-10">
                        <table class="min-w-full divide-y divide-gray-200 stat-table">
                            <thead class="bg-indigo-600 text-white">
                                <tr>
                                    <th class="px-3 py-3 text-left text-xs font-bold uppercase tracking-wider">Rank</th>
                                    <th class="px-3 py-3 text-left text-xs font-bold uppercase tracking-wider">Team</th>
                                    <th class="px-3 py-3 text-center text-xs font-bold uppercase tracking-wider">W</th>
                                    <th class="px-3 py-3 text-center text-xs font-bold uppercase tracking-wider">L</th>
                                    <th class="px-3 py-3 text-center text-xs font-bold uppercase tracking-wider">Win %</th>
                                    <th class="px-3 py-3 text-center text-xs font-bold uppercase tracking-wider">Points</th>
                                    <th class="px-3 py-3 text-center text-xs font-bold uppercase tracking-wider">Opp Pts</th>
                                    <th class="px-3 py-3 text-center text-xs font-bold uppercase tracking-wider">Diff</th>
                                </tr>
                            </thead>
                            <tbody id="standings-table-body" class="divide-y divide-gray-200">
                                <!-- Standings rows generated by JS -->
                            </tbody>
                        </table>
                    </div>

                    <!-- League Leaders Section -->
                    <div class="mt-10 pt-6 border-t border-gray-300">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Division Leaders</h2>
                        <div id="leaders-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Leader cards generated by JS -->
                        </div>
                    </div>
                </div>

                <!-- 2. Team Stats View -->
                <div id="team-stats-view" class="hidden">
                    <h2 id="team-name-header" class="text-3xl font-extrabold text-indigo-700 mb-4"></h2>
                    
                    <div class="flex justify-between items-center bg-gray-100 p-4 rounded-lg mb-6 flex-wrap gap-4">
                        <div class="flex space-x-4">
                            <button id="player-avgs-tab" class="px-4 py-2 text-sm font-semibold rounded-lg bg-indigo-500 text-white shadow" onclick="setTeamSubView('averages')">Player Averages</button>
                            <button id="game-logs-tab" class="px-4 py-2 text-sm font-medium rounded-lg bg-white text-gray-700 shadow hover:bg-gray-50" onclick="setTeamSubView('logs')">Game Logs</button>
                        </div>
                        <div class="w-full sm:w-auto">
                            <label for="week-filter-select" class="sr-only">Filter by Week</label>
                            <select id="week-filter-select" onchange="renderTeamStats()" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                                <!-- Week options populated by JS -->
                            </select>
                        </div>
                    </div>

                    <div id="team-data-content" class="bg-white rounded-xl shadow-2xl overflow-x-auto">
                        <!-- Table content generated by JS -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let LEAGUE_DATA = {};
        let currentSeason = 'Winter 2025';
        let currentDivision = 'D2';
        let currentTeam = null;
        let currentView = 'standings';
        let currentTeamSubView = 'averages';
        let currentSort = { key: 'rank', direction: 'ascending' };
        let maxWeek = 0;
        let currentWeekFilter = 0; // 0 means cumulative

        const statKeys = [
            { key: 'totalpoints', label: 'PTS', isAvg: true },
            { key: 'rebounds', label: 'REB', isAvg: true },
            { key: 'assists', label: 'AST', isAvg: true },
            { key: 'blocks', label: 'BLK', isAvg: true },
            { key: 'steals', label: 'STL', isAvg: true },
            { key: 'turnovers', label: 'TO', isAvg: true },
            { key: 'fouls', label: 'FLS', isAvg: true },
            { key: 'ftm', label: 'FTM', isAvg: true },
            { key: 'fta', label: 'FTA', isAvg: true },
            { key: 'ft_percent', label: 'FT%', isAvg: false, isPercent: true },
            { key: '2pm', label: '2PM', isAvg: true },
            { key: '2pa', label: '2PA', isAvg: true },
            { key: 'two_p_percent', label: '2P%', isAvg: false, isPercent: true },
            { key: '3pm', label: '3PM', isAvg: true },
            { key: '3pa', label: '3PA', isAvg: true },
            { key: 'three_p_percent', label: '3P%', isAvg: false, isPercent: true },
            { key: 'fg_percent', label: 'FG%', isAvg: false, isPercent: true }
        ];


        // --- UTILITY FUNCTIONS ---

        function formatPercent(value) {
            if (typeof value === 'number' && !isNaN(value)) {
                return (value * 100).toFixed(1) + '%';
            }
            return '0.0%';
        }

        function getFilteredStandings() {
            const standings = LEAGUE_DATA[currentSeason]?.finalStandings || [];
            const searchInput = document.getElementById('searchInput')?.value.toLowerCase() || '';

            return standings.filter(team => {
                const divisionMatch = currentDivision === 'All' || team.division === currentDivision;
                
                if (!divisionMatch) return false;

                if (searchInput) {
                    // Search by team name only in standings view
                    return team.team.toLowerCase().includes(searchInput);
                }
                
                return true;
            });
        }
        
        function getFilteredPlayerLogs(teamName = null) {
            const logs = LEAGUE_DATA[currentSeason]?.playerGameLogs || [];
            
            return logs.filter(log => {
                const divisionMatch = currentDivision === 'All' || log.division === currentDivision;
                const teamMatch = !teamName || log.team === teamName;
                const weekMatch = currentWeekFilter === 0 || log.week <= currentWeekFilter;
                
                return divisionMatch && teamMatch && weekMatch;
            });
        }

        function getDivisionTeams(division) {
            const standings = LEAGUE_DATA[currentSeason]?.finalStandings || [];
            return standings
                .filter(s => s.division === division)
                .map(s => s.team);
        }

        // --- CALCULATION LOGIC ---

        function calculatePlayerAverages(playerLogs) {
            const players = {};

            playerLogs.forEach(log => {
                const key = log.name + log.jersey;
                if (!players[key]) {
                    players[key] = {
                        name: log.name,
                        jersey: log.jersey,
                        team: log.team,
                        games_played: 0,
                        raw_stats: {}
                    };
                    statKeys.filter(s => s.isAvg).forEach(s => players[key].raw_stats[s.key] = 0);
                }

                players[key].games_played += 1;
                
                // Sum all raw stats
                statKeys.filter(s => s.isAvg).forEach(s => {
                    players[key].raw_stats[s.key] += (log[s.key] || 0);
                });
            });

            // Calculate final averages and percentages
            return Object.values(players).map(p => {
                const avgStats = { name: p.name, jersey: p.jersey, team: p.team, games_played: p.games_played };
                const gp = p.games_played;

                statKeys.filter(s => s.isAvg).forEach(s => {
                    avgStats[s.key] = p.raw_stats[s.key] / gp;
                });

                // Calculate shooting percentages
                // NOTE: We only calculate FG% and 2P%/3P% here for display. Since the Excel provided the base %'s, we use them for consistency.
                // However, since we only have raw totals in logs, we must calculate the aggregate here.
                avgStats.ft_percent = (p.raw_stats.fta > 0) ? p.raw_stats.ftm / p.raw_stats.fta : 0;
                avgStats.two_p_percent = (p.raw_stats['2pa'] > 0) ? p.raw_stats['2pm'] / p.raw_stats['2pa'] : 0;
                avgStats.three_p_percent = (p.raw_stats['3pa'] > 0) ? p.raw_stats['3pm'] / p.raw_stats['3pa'] : 0;
                
                const fga = p.raw_stats['2pa'] + p.raw_stats['3pa'];
                const fgm = p.raw_stats['2pm'] + p.raw_stats['3pm'];
                avgStats.fg_percent = (fga > 0) ? fgm / fga : 0;


                return avgStats;
            }).sort((a, b) => b.totalpoints - a.totalpoints); // Sort by highest PPG
        }

        function calculateLeaders(filteredPlayers) {
            const leaders = {};
            const categories = ['totalpoints', 'rebounds', 'assists', 'fg_percent', 'blocks', 'steals'];

            // 1. Get Averages
            const playerAverages = calculatePlayerAverages(filteredPlayers);
            
            // 2. Determine Leaders
            categories.forEach(cat => {
                // Sort players by the current category in descending order
                let sorted = [...playerAverages].sort((a, b) => {
                    // Handle percentage keys for accurate sorting
                    const aVal = a[cat] || 0;
                    const bVal = b[cat] || 0;
                    return bVal - aVal;
                });

                // Get top 5 players
                leaders[cat] = sorted.slice(0, 5).map(p => ({
                    name: p.name,
                    team: p.team,
                    value: cat.includes('percent') ? formatPercent(p[cat]) : p[cat].toFixed(1),
                    raw_value: p[cat]
                }));
            });

            return leaders;
        }

        // --- RENDER FUNCTIONS ---

        function renderStandings(standings) {
            const tbody = document.getElementById('standings-table-body');
            const searchInput = document.getElementById('searchInput')?.value.toLowerCase() || '';
            tbody.innerHTML = '';

            const filteredAndSortedStandings = [...standings].sort((a, b) => a.rank - b.rank); // Sort by official rank

            if (filteredAndSortedStandings.length === 0) {
                tbody.innerHTML = `<tr><td colspan="8" class="text-center py-6 text-gray-500">No standings found for ${currentDivision}.</td></tr>`;
                return;
            }

            filteredAndSortedStandings.forEach(team => {
                // Determine Win/Loss record text color
                const recordColor = team.wins > team.losses ? 'text-green-600 font-semibold' : (team.losses > team.wins ? 'text-red-600' : 'text-gray-700');
                const diffColor = team.point_diff > 0 ? 'text-green-600 font-semibold' : (team.point_diff < 0 ? 'text-red-600' : 'text-gray-700');

                const row = document.createElement('tr');
                row.className = 'hover:bg-indigo-50 transition cursor-pointer';
                row.onclick = () => showTeamStats(team.team);

                row.innerHTML = `
                    <td class="py-3 font-bold text-indigo-700 text-center">${team.rank}</td>
                    <td class="py-3 font-medium text-gray-900">${team.team} <span class="text-xs text-gray-500 block sm:inline">(${team.division})</span></td>
                    <td class="py-3 text-center ${recordColor}">${team.wins}</td>
                    <td class="py-3 text-center ${recordColor}">${team.losses}</td>
                    <td class="py-3 text-center font-mono">${formatPercent(team.win_percent)}</td>
                    <td class="py-3 text-center">${team.points_for}</td>
                    <td class="py-3 text-center">${team.points_against}</td>
                    <td class="py-3 text-center ${diffColor}">${team.point_diff}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderLeaders(leaders) {
            const grid = document.getElementById('leaders-grid');
            grid.innerHTML = '';

            const leaderCategories = [
                { key: 'totalpoints', label: 'PPG Leader' },
                { key: 'assists', label: 'APG Leader' },
                { key: 'rebounds', label: 'RPG Leader' },
                { key: 'steals', label: 'SPG Leader' },
                { key: 'blocks', label: 'BPG Leader' },
                { key: 'fg_percent', label: 'FG% Leader' },
            ];

            leaderCategories.forEach(cat => {
                const topPlayer = leaders[cat.key][0];
                const value = topPlayer ? topPlayer.value : '--';
                const name = topPlayer ? topPlayer.name : 'N/A';
                const team = topPlayer ? topPlayer.team : '';

                const card = document.createElement('div');
                card.className = 'bg-white p-4 rounded-xl shadow border-l-4 border-indigo-400';
                card.innerHTML = `
                    <p class="text-xs font-semibold uppercase text-gray-500">${cat.label}</p>
                    <p class="mt-1 text-2xl font-extrabold text-indigo-700">${value}</p>
                    <p class="text-sm text-gray-700">${name} <span class="text-xs text-gray-500">(${team})</span></p>
                `;
                grid.appendChild(card);
            });
        }

        function renderTeamStats() {
            if (!currentTeam) return;

            document.getElementById('team-name-header').textContent = currentTeam;
            
            const contentDiv = document.getElementById('team-data-content');
            contentDiv.innerHTML = '';

            // Get all player logs for the current team AND current week filter
            const allTeamLogs = getFilteredPlayerLogs(currentTeam);
            
            if (allTeamLogs.length === 0) {
                contentDiv.innerHTML = `<div class="p-6 text-center text-gray-500">No data found for ${currentTeam} in the selected week range.</div>`;
                return;
            }

            let tableHTML = `<table class="min-w-full divide-y divide-gray-200 stat-table">
                <thead class="bg-indigo-600 text-white"><tr>`;

            // Define headers based on the current sub-view
            let headers = [];
            if (currentTeamSubView === 'averages') {
                headers = ['Player', 'GP', ...statKeys.map(s => s.label)];
            } else { // Logs view
                headers = ['Week', 'Player', ...statKeys.map(s => s.label)];
            }

            headers.forEach(h => {
                tableHTML += `<th class="px-3 py-3 text-left text-xs font-bold uppercase tracking-wider">${h}</th>`;
            });
            tableHTML += `</tr></thead><tbody class="divide-y divide-gray-200">`;

            if (currentTeamSubView === 'averages') {
                const playerAverages = calculatePlayerAverages(allTeamLogs);

                playerAverages.forEach(player => {
                    tableHTML += `<tr class="hover:bg-gray-50 transition">
                        <td class="py-3 font-medium text-gray-900">${player.name} <span class="text-xs text-gray-500">(${player.jersey})</span></td>
                        <td class="py-3 text-center">${player.games_played}</td>`;
                        
                    statKeys.forEach(s => {
                        let value = player[s.key] || 0;
                        let display = s.isPercent ? formatPercent(value) : value.toFixed(1);
                        tableHTML += `<td class="py-3 text-center ${s.isPercent ? 'font-semibold text-green-600' : 'text-gray-700'}">${display}</td>`;
                    });
                    tableHTML += `</tr>`;
                });
            } else { // Logs
                // Filter logs down to only the specific week if selected, otherwise show all
                const weekLogs = (currentWeekFilter > 0) 
                    ? allTeamLogs.filter(log => log.week === currentWeekFilter) 
                    : allTeamLogs.sort((a, b) => a.week - b.week);
                
                weekLogs.forEach(log => {
                    tableHTML += `<tr class="hover:bg-gray-50 transition">
                        <td class="py-3 font-bold text-indigo-500 text-center">${log.week}</td>
                        <td class="py-3 font-medium text-gray-900">${log.name} <span class="text-xs text-gray-500">(${log.jersey})</span></td>`;

                    statKeys.forEach(s => {
                        let value = log[s.key] || 0;
                        let display = s.isPercent ? formatPercent(value) : value; // Logs use raw numbers from Python
                        if (s.isPercent) {
                             display = formatPercent(value);
                        } else if (s.key === 'totalpoints') {
                             display = value; // Show Points as whole number
                        } else {
                             display = value; // Show everything else as is
                        }


                        tableHTML += `<td class="py-3 text-center ${s.isPercent ? 'font-semibold text-green-600' : 'text-gray-700'}">${display}</td>`;
                    });
                    tableHTML += `</tr>`;
                });

                if (weekLogs.length === 0) {
                    tableHTML += `<tr><td colspan="${headers.length}" class="text-center py-6 text-gray-500">No game logs found for Week ${currentWeekFilter}.</td></tr>`;
                }
            }

            tableHTML += `</tbody></table>`;
            contentDiv.innerHTML = tableHTML;
            
            // Update sub-view buttons state
            document.querySelectorAll('#team-stats-view button').forEach(btn => {
                btn.classList.remove('bg-indigo-500', 'text-white');
                btn.classList.add('bg-white', 'text-gray-700');
            });
            document.getElementById(currentTeamSubView === 'averages' ? 'player-avgs-tab' : 'game-logs-tab').classList.add('bg-indigo-500', 'text-white');
            document.getElementById(currentTeamSubView === 'averages' ? 'player-avgs-tab' : 'game-logs-tab').classList.remove('bg-white', 'text-gray-700');
        }


        // --- VIEW CONTROL ---

        function setTabView(viewName) {
            currentView = viewName;

            // Update tab buttons visually
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-button[onclick="setTabView('${viewName}')"]`).classList.add('active');

            // Hide/Show main content views
            document.getElementById('standings-view').classList.add('hidden');
            document.getElementById('team-stats-view').classList.add('hidden');
            document.getElementById('standings-search-container').classList.add('hidden');

            if (viewName === 'standings') {
                document.getElementById('standings-view').classList.remove('hidden');
                document.getElementById('standings-search-container').classList.remove('hidden');
                document.getElementById('team-stats-tab').disabled = (currentTeam === null);
            } else if (viewName === 'team') {
                if (currentTeam) {
                    document.getElementById('team-stats-view').classList.remove('hidden');
                    renderTeamStats();
                } else {
                    // Fallback to standings if somehow team view is clicked without a selected team
                    setTabView('standings');
                }
            }
        }

        function setTeamSubView(subViewName) {
            currentTeamSubView = subViewName;
            renderTeamStats();
        }
        
        function showTeamStats(teamName) {
            currentTeam = teamName;
            document.getElementById('team-stats-tab').disabled = false;
            setTabView('team'); // Switch to the team view
        }

        // --- FILTER AND INITIALIZATION ---

        function updateDivisionFilter(divisions) {
            const select = document.getElementById('division-select');
            select.innerHTML = '<option value="All">All Divisions</option>';
            
            divisions
                .filter(d => d) // CRITICAL: Filter out any null/blank division names
                .sort()
                .forEach(div => {
                    const option = document.createElement('option');
                    option.value = div;
                    option.textContent = div;
                    select.appendChild(option);
                });
            
            // Set D2 as default if available
            if (divisions.includes('D2')) {
                currentDivision = 'D2';
                select.value = 'D2';
            } else {
                currentDivision = 'All';
                select.value = 'All';
            }
        }

        function updateWeekFilter(weeks) {
            const select = document.getElementById('week-filter-select');
            select.innerHTML = '';

            // Option 0: Cumulative up to Max Week
            const cumulativeOption = document.createElement('option');
            cumulativeOption.value = 0;
            cumulativeOption.textContent = `Cumulative (Week 1 - ${maxWeek})`;
            select.appendChild(cumulativeOption);

            // Options 1 to Max Week
            for (let i = 1; i <= maxWeek; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Up to Week ${i}`;
                select.appendChild(option);
            }
            currentWeekFilter = 0;
        }

        function filterData() {
            // Read current filter settings
            currentSeason = document.getElementById('season-select').value;
            currentDivision = document.getElementById('division-select').value;
            
            // Execute rendering based on current view
            if (currentView === 'standings') {
                const filteredStandings = getFilteredStandings();
                renderStandings(filteredStandings);
                
                // Recalculate and render leaders based on the filtered player logs
                const playersForLeaders = getFilteredPlayerLogs();
                const leaders = calculateLeaders(playersForLeaders);
                renderLeaders(leaders);

                // Update total teams count
                document.getElementById('total-teams-count').textContent = filteredStandings.length;
            } else if (currentView === 'team' && currentTeam) {
                renderTeamStats();
            }
        }

        async function init() {
            try {
                // Fetch the JSON file from the root of the repository
                const response = await fetch('league_data.json'); 
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                LEAGUE_DATA = data;
                
                // 1. Initial Season Setup (assuming one season for now, 'Winter 2025')
                const seasonSelect = document.getElementById('season-select');
                seasonSelect.innerHTML = '';
                Object.keys(LEAGUE_DATA).forEach(season => {
                    const option = document.createElement('option');
                    option.value = season;
                    option.textContent = season;
                    seasonSelect.appendChild(option);
                });
                currentSeason = seasonSelect.value;
                
                // 2. Identify all unique divisions and max week
                const divisions = [...new Set(LEAGUE_DATA[currentSeason]?.finalStandings.map(s => s.division) || [])];
                maxWeek = Math.max(...(LEAGUE_DATA[currentSeason]?.playerGameLogs.map(l => l.week) || [0]));
                
                // 3. Populate Filters
                updateDivisionFilter(divisions);
                updateWeekFilter(maxWeek);

                // 4. Set Initial View (triggers initial rendering based on filters)
                setTabView('standings');
                filterData();
                
                document.getElementById('dataStatus').textContent = 'Data Loaded Successfully';

            } catch (error) {
                document.getElementById('dataStatus').textContent = 'ERROR: See Console';
                console.error("Initialization Error:", error);
            }
        }

        // Initialize the app on page load
        window.onload = init;
    </script>
</body>
</html>
